<div class="container mt-5" style="max-width: 650px;">

  <div class="card shadow p-4">
    <h2 class="text-center mb-4 border-bottom pb-2 text-dark-emphasis">Registro de Usuario</h2>

    <form [formGroup]="registroForm" (ngSubmit)="registrar()" class="row g-4">

      <!-- FOTO DE PERFIL -->
<div class="col-12 text-center">
  <div class="contenedor-foto">
    <img 
      [src]="imagenPreview"
      (error)="imagenPreview = 'assets/img/default.png'"
      alt="Previsualización"
      class="foto-perfil">
  </div>

  <!-- botón redondeado personalizado -->
  <label class="btn btn-salmon rounded-pill mt-3">
    Subir foto
    <input type="file" class="d-none" (change)="previsualizarImagen($event)">
  </label>
</div>


      <!-- NOMBRE -->
      <div class="col-12">
        <label for="nombreUsuario" class="form-label fw-bold">Nombre</label>
        <input
          type="text"
          id="nombreUsuario"
          class="form-control"
          formControlName="nombreUsuario"
          placeholder="Tu nombre"
        />
        <small class="text-danger" *ngIf="mostrarError('nombreUsuario','required')">
          El nombre es obligatorio.
        </small>
        <small class="text-danger" *ngIf="mostrarError('nombreUsuario','pattern')">
          Solo letras, entre 2–20 caracteres.
        </small>
      </div>

      <!-- APELLIDOS -->
      <div class="col-12">
        <label for="apellidoUsuario" class="form-label fw-bold">Apellidos</label>
        <input
          type="text"
          id="apellidoUsuario"
          class="form-control"
          formControlName="apellidoUsuario"
          placeholder="Tus apellidos"
        />
        <small class="text-danger" *ngIf="mostrarError('apellidoUsuario','required')">
          Los apellidos son obligatorios.
        </small>
        <small class="text-danger" *ngIf="mostrarError('apellidoUsuario','pattern')">
          Solo letras, entre 2–20 caracteres.
        </small>
      </div>

      <!-- CORREO -->
      <div class="col-12">
        <label for="correo" class="form-label fw-bold">Correo</label>
        <input
          type="email"
          id="correo"
          class="form-control"
          formControlName="correo"
          placeholder="ejemplo@correo.com"
        />
        <small class="text-danger" *ngIf="mostrarError('correo','required')">
          El correo es obligatorio.
        </small>
        <small class="text-danger" *ngIf="mostrarError('correo','email')">
          Introduce un correo válido.
        </small>
      </div>

      <!-- Contraseña -->
<div class="mb-3 position-relative">
  <label for="contrasena" class="form-label fw-bold">Contraseña</label>

  <input
    [type]="mostrarContrasena ? 'text' : 'password'"
    id="contrasena"
    class="form-control"
    formControlName="contrasena"/>

  <!-- Icono de ojo -->
  <i class="bi" [ngClass]="mostrarContrasena ? 'bi-eye-slash' : 'bi-eye'"
    (click)="mostrarContrasena = !mostrarContrasena"
    style="position: absolute; right: 30px; top: 45px; cursor: pointer;"></i>

  <small class="text-danger" *ngIf="mostrarError('contrasena', 'required')">
    La contraseña es obligatoria.
  </small>
  <small class="text-danger" *ngIf="mostrarError('contrasena', 'pattern')">
    La contraseña debe tener al menos 6 caracteres e incluir letras y números.
  </small>
</div>

<!-- Repetir contraseña -->
<div class="mb-3 position-relative">
  <label for="repitePassword" class="form-label fw-bold">Repite la contraseña</label>

  <input
    [type]="mostrarRepite ? 'text' : 'password'"
    id="repitePassword"
    class="form-control"
    formControlName="repitePassword"/>

  <!-- Icono de ojo -->
  <i class="bi" [ngClass]="mostrarRepite ? 'bi-eye-slash' : 'bi-eye'"
    (click)="mostrarRepite = !mostrarRepite"
    style="position: absolute; right: 30px; top: 45px; cursor: pointer;"></i>

  <small class="text-danger" *ngIf="mostrarError('repitePassword', 'required')">
    Debes repetir la contraseña.
  </small>
  <small class="text-danger" *ngIf="registroForm.get('repitePassword')?.hasError('noCoinciden')
  && registroForm.get('repitePassword')?.touched">
  Las contraseñas no coinciden.
</small>
</div>


      <!-- FAMILIA -->
      <div class="col-12">
        <label for="idFamilia" class="form-label fw-bold">Selecciona la familia (opcional)</label>
        <select id="idFamilia" class="form-select" formControlName="idFamilia">
          <option [ngValue]="null">-- Sin familia --</option>
          <option *ngFor="let f of familias" [ngValue]="f.idFamilia">{{ f.nombreFamilia }}</option>
        </select>
      </div>

      <!-- BOTÓN REGISTRAR -->
      <div class="col-12 text-center mt-3">
        <button type="submit" class="btn btn-success rounded-pill px-4" [disabled]="registroForm.invalid">
          Registrarme
        </button>
      </div>
    </form>
  </div>
</div>
