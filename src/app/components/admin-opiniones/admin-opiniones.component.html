<div class="container my-4">

  <!-- ======= Encabezado ======= -->
  <div class="header-fijo text-center bg-white p-4 rounded shadow-sm mb-4">
    <h4 class="fw-bold mb-3">GestiÃ³n de Opiniones</h4>

    <!-- Botones de modo -->
    <div class="btn-group">
      <button class="btn btn" [class.activo]="modoVista === 'todas'" (click)="cambiarModo('todas')">
        Todas
      </button>
      <button class="btn btn" [class.activo]="modoVista === 'actividad'" (click)="cambiarModo('actividad')">
        Por actividad
      </button>
      <button class="btn btn" [class.activo]="modoVista === 'familia'" (click)="cambiarModo('familia')">
        Por familia
      </button>
    </div>

    <!-- Filtro -->
    <div class="filtro-container">
      <select *ngIf="modoVista === 'actividad'" class="form-select"
              (change)="onActividadSeleccionada($any($event.target).value)">
        <option value="">Seleccione una actividad</option>
        <option *ngFor="let a of actividades" [value]="a.idActividad">{{ a.nombreActividad }}</option>
      </select>

      <select *ngIf="modoVista === 'familia'" class="form-select"
              (change)="onFamiliaSeleccionada($any($event.target).value)">
        <option value="">Seleccione una familia</option>
        <option *ngFor="let f of familias" [value]="f.idFamilia">{{ f.nombreFamilia }}</option>
      </select>
    </div>
  </div>

  <!-- ======= Spinner de carga ======= -->
  <div *ngIf="cargando" class="d-flex justify-content-center align-items-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <!-- ======= Tarjetas de opiniones ======= -->
  <div *ngIf="!cargando && opiniones.length > 0" class="row justify-content-center">
    <div *ngFor="let op of opiniones" class="col-md-4 col-sm-6 mb-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body d-flex flex-column justify-content-between">
          <h5 class="card-title">{{ op.actividadDTO?.nombreActividad }}</h5>
          <p class="card-text mb-1"><strong>Familia:</strong> {{ op.familiaDTO?.nombreFamilia }}</p>
          <p class="card-text mb-1"><strong>PuntuaciÃ³n:</strong> {{ op.puntuacion }}/5</p>
          <p class="card-text"><strong>Comentario:</strong> {{ op.comentario }}</p>
          <p class="text-muted small">ğŸ—“ï¸ {{ op.fechaOpinion | date:'dd/MM/yyyy' }}</p>

          <button class="btn btn-outline-danger mt-2" (click)="eliminarOpinion(op.idOpinion!)">
            ğŸ—‘ï¸ Eliminar opiniÃ³n
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ======= Sin resultados ======= -->
  <div *ngIf="!cargando && opiniones.length === 0" class="text-center text-muted">
     <i class="bi bi-info-circle"></i>No hay opiniones registradas para esta selecciÃ³n.
  </div>

</div>
